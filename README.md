# Library
REST-сервис по учету книг и читателей в библиотеках. 

Предметная область - библиотека. 

Основная композиция: читатель - книги, которые он взял почитать. Связь для данной композиции -> один ко многим - один читатель может взять одновременно много книг.

Дополнительные сущности для описания предметной области: автор и жанр. 

Дополнительные композиции: 
 - книга - автор: связь -> многие к одному - много книг написано одним автором;
 - книга - жанр: связь -> многие к одному - много книг написано в одном жанре (примечание: в данной предметной области у книги может быть только один жанр).
 
 ## Схема предметной области
 ![schema_DB _Llibrary_ drawio](https://github.com/YuliyaRR/Library/assets/110600085/6a140b11-a8ed-4032-ba42-e0f850de9713)

 ## Основной функционал
  - CRUD-операции с книгами;
  - CRUD-операции с читателями;
  - запись выбранных книг читателю;
  - "возврат" книг читателем.

## Используемые технологии
 - Java 17;
 - Spring Boot (MVC, Data JPA, Validation);
 - Hibernate;
 - PostgreSQL;
 - Lombok;
 - Maven.

## Подключенные зависимости и их назначение
 - Spring Web -> создание RESTful веб-приложений, подключение Tomcat как встроенного контейнера сервлетов;
 - Spring Data JPA -> механизм для взаимодействия с сущностями базы данных, организации их в репозитории и работы с ними по спецификации JPA, в качестве ORM выступает Hibernate;
 - Hibernate Validator -> обеспечивает валидацию входных данных от пользователя и данных, передаваемых от контроллера к сервису, посредством аннотаций;
 - PostgreSQL Driver -> драйвер JDBC, который позволяет Java-приложению подключаться к БД PostrgeSQL, используя стандартный, независимый от БД, Java-код. В качестве пула коннектов по дефолту выступает HikariCP;
 - Lombok -> библиотека, используемая с целью минимизации рутинного Java-кода (геттеры, сеттеры, конструкторы и пр.).

## Порядок сборки проекта
1. создать папку на рабочем компьютере, где будет размещен проект;
2. войти в эту папку через командную строку и выполнить команду git clone https://github.com/YuliyaRR/Library.git;
3. установить PostgreSQL (БД). Это можно сделать по ссылке https://www.postgresql.org/download/ согласно инструкциям на официальном сайте;
4. установить pgAdmin (графический интерфейс для работы с БД PostgreSQL). Это можно сделать по ссылке https://www.pgadmin.org/download/ согласно инструкциям на официальном сайте;
5. установить Postman для тестирования API приложения. Это можно сделать по ссылке https://www.postman.com/downloads/ согласно инструкциям на официальном сайте;
6. установить и настроить систему сборки Maven. Это можно сделать по ссылке https://maven.apache.org/download.cgi согласно инструкциям на официальном сайте;
7. зайти в pgAdmin и создать базу данных library (!только корневую папку, схема и таблицы создадутся автоматически при запуске приложения);
8. открыть проект в IDE и запустить его;
9. импортировать в Postman файл library.postman_collection.json (содержит коллекцию запросов для тестирования API приложения);
10. запустить в Postman запросы. !!ВНИМАНИЕ!! Часть данных в запросе необходимо изменить (uuid и dt_update), т.к. они динамически изменяются при каждом запуске приложения и запросов!!! Следуйте инструкциям, раземещенным в Body запросов в комментариях!!
 
## Endpoints
### POST /books/new
Создание новой книги. 

Запрос передается в формате JSON вида:

![image](https://github.com/YuliyaRR/Library/assets/110600085/edc8fd32-9499-4b4a-b2ff-bc6782353ce2)

В случае успешного создания возвращается статус 201 Created.

В случае передачи невалидных данных возвращается статус 400 Bad Request и ответ в формате JSON вида:

![image](https://github.com/YuliyaRR/Library/assets/110600085/18f736ba-d0e4-4a44-8f0f-1ea043d87162)

### GET /books
Просмотр всех книг.

Ответ в формате JSON вида:

![image](https://github.com/YuliyaRR/Library/assets/110600085/65a2bc10-f1e0-49d0-a036-45f3d4c77eb0)

### GET /books/{uuid}
Просмотр информации о конкретной книге. UUID книги передается в пути запроса.

В случае валидности UUID и наличия данной книги в библиотеке возвращается ответ в формате JSON:

![image](https://github.com/YuliyaRR/Library/assets/110600085/dd8583cc-7037-4d85-991c-be037e539e74)

Если книга не найдена в библиетеке, JSON-ответ будет иметь статус 404 Not Found и вид:

![image](https://github.com/YuliyaRR/Library/assets/110600085/aa2cc956-a5b6-4c02-926c-2b607db12ed3)

### PUT /books/{uuid}/dt_update/{dt_update}
Обновление информации о книге. В пути запроса передается UUID книги и версия (дата последнего обновления в миллисек.), в теле запроса в формате JSON передается информация о книге для обновления:

![image](https://github.com/YuliyaRR/Library/assets/110600085/fcc57b42-eb5b-45f1-bae3-ac92e6a8e862)

В случае успешного обновления возвращается статус 200 OK.

Если книга не найдена в библиотеке либо переданная версия не совпадает с версией в БД, статус возвата - 404 Not Found. В случае передачи невалидных данных возвращается статус 400 Bad Request. В обоих случаях JSON-ответ будет такой же структуры, как в примерах выше.

### DELETE /books/{uuid}
Удаление книги, UUID которой передан в пути запроса.

В случае валидности UUID и наличия данной книги в библиотеке возвращается статус 200 OK.

Если книга не найдена в библиотеке - статус возврата - 404 Not Found.

### POST /readers/new

Регистрация нового читателя. 

Запрос передается в формате JSON вида:

![image](https://github.com/YuliyaRR/Library/assets/110600085/55f7b79a-8d01-4cd0-a5e5-a1e008d0d523)

В случае успешного создания возвращается статус 201 Created.

В случае передачи невалидных данных возвращается статус 400 Bad Request и ответ в формате JSON вида:

![image](https://github.com/YuliyaRR/Library/assets/110600085/5667b804-072b-41ae-ae5d-a3e102364a81)

### GET /readers
Просмотр информации обо всех читателях.

Ответ в формате JSON вида:

![image](https://github.com/YuliyaRR/Library/assets/110600085/3a4fb10f-3fd5-457b-9003-2844f45494ce)

### GET /readers/{uuid}
Просмотр информации о конкретном читателе. UUID читателя передается в пути запроса.

В случае валидности UUID и если читатель зарегистрирован в библиотеке возвращается ответ в формате JSON:

![image](https://github.com/YuliyaRR/Library/assets/110600085/f700290e-47bc-48e7-916e-686c66c76f24)

Если читатель не найден, JSON-ответ будет иметь статус 404 Not Found и вид:

![image](https://github.com/YuliyaRR/Library/assets/110600085/2e007b32-6ae6-4563-8a84-814b47a73c82)

### PUT /readers/{uuid}/dt_update/{dt_update}
Обновление информации о читателе. В пути запроса передается UUID читателя и версия (дата последнего обновления в миллисек.), в теле запроса в формате JSON передается информация о читателе для обновления:

![image](https://github.com/YuliyaRR/Library/assets/110600085/2c41f83e-5a3f-45b3-bbad-b33ae3aedabb)

Только перечисленная в JSON персональная информация приводит к обновлению версии читателя! Операции со списком книг не приводят к обновлению версии!

В случае успешного обновления возвращается статус 200 OK.

Если читатель не зарегистрирован в библиотеке либо переданная версия не совпадает с версией в БД, статус возвата - 404 Not Found. В случае передачи невалидных данных возвращается статус 400 Bad Request. В обоих случаях JSON-ответ будет такой же структуры, как в примерах выше.

### DELETE /readers/{uuid}
Удаление читателя, UUID которого передан в пути запроса.

В случае валидности UUID и если данный читатель зарегистрирован в библиотеке - возвращается статус 200 OK.

Если читатель не найден - статус возврата - 404 Not Found и вид, как в примерах выше.

### PUT /readers/take
Запись выбранных книг читателю. Информация о читателе и выбранных книгах передается в формате JSON:

![image](https://github.com/YuliyaRR/Library/assets/110600085/96e0d959-7476-47c5-a2f7-1c2d48a4fd7f)

Если читатель не найден, JSON-ответ будет иметь статус 404 Not Found и вид, как в примерах выше.

Если книги не найдены, JSON-ответ будет иметь статус 404 Not Found и вид, как в примерах выше. 

Если часть книг не найдена, а часть есть, то читателю будет записана часть, найденная в библиотеке, при условии, что они свободны. 

Перед записью книг читателю проверяется, чтобы они были свободны. Если часть книг записана уже другому читателю, то текущему читателю будет записана свободная часть книг, а о занятых книгах будет выведено JSON-сообщение вида: 

![image](https://github.com/YuliyaRR/Library/assets/110600085/bdd88caa-5a91-4ac4-8a66-83c0a570445d)

### PUT /readers/return
Возврат читателем прочитанных книг. Информация о читателе и возвращенных книгах передается в формате JSON:

![image](https://github.com/YuliyaRR/Library/assets/110600085/b8c642b5-1b5f-41d3-94b6-c550de080fd1)

Если читатель не найден, JSON-ответ будет иметь статус 404 Not Found и вид, как в примерах выше.

Если книги не найдены, JSON-ответ будет иметь статус 404 Not Found и вид, как в примерах выше.

Если часть книг не найдена, а часть записана на текущего читателя, то читателю будет списана часть книг, учтенная за ним и выведенно JSON-сообщение вида:

![image](https://github.com/YuliyaRR/Library/assets/110600085/56ffdae2-07e1-49bf-a017-1c1badc4c004)


